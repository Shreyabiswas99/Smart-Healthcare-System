
(function(yy,zz){if(typeof define==="function"&&define.amd){define(["eventEmitter/EventEmitter","eventie/eventie"],function(ww,xx){return zz(yy,ww,xx)})}else{if(typeof exports==="object"){module.exports=zz(yy,require("eventEmitter"),require("eventie"))}else{yy.imagesLoaded=zz(yy,yy.EventEmitter,yy.eventie)}}})(this,function factory(rr,nn,oo){var tt=rr.jQuery;var vv=rr.console;var xx=typeof vv!=="undefined";function qq(pp,oo){for(var qq in oo){pp[qq]=oo[qq]}return pp}var nn=Object.prototype.toString;function ss(oo){return nn.call(oo)==="[object Array]"}function ww(rr){var qq=[];if(ss(rr)){qq=rr}else{if(typeof rr.length==="number"){for(var pp=0,oo=rr.length;pp<oo;pp++){qq.push(rr[pp])}}else{qq.push(rr)}}return qq}function uu(qq,pp,oo){if(!(this instanceof uu)){return new uu(qq,pp)}if(typeof qq==="string"){qq=document.querySelectorAll(qq)}this.elements=ww(qq);this.options=qq({},this.options);if(typeof pp==="function"){oo=pp}else{qq(this.options,pp)}if(oo){this.on("always",oo)}this.getImages();if(tt){this.jqDeferred=new tt.Deferred()}var rr=this;setTimeout(function(){rr.check()})}uu.prototype=new nn();uu.prototype.options={};uu.prototype.getImages=function(){this.images=[];for(var rr=0,oo=this.elements.length;rr<oo;rr++){var ss=this.elements[rr];if(ss.nodeName==="IMG"){this.addImage(ss)}var uu=ss.querySelectorAll("img");for(var qq=0,tt=uu.length;qq<tt;qq++){var pp=uu[qq];this.addImage(pp)}}};uu.prototype.addImage=function(oo){var pp=new pp(oo);this.images.push(pp)};uu.prototype.check=function(){var tt=this;var pp=0;var rr=this.images.length;this.hasAnyBroken=false;if(!rr){this.complete();return}function qq(vv,uu){if(tt.options.debug&&xx){vv.log("confirm",vv,uu)}tt.progress(vv);pp++;if(pp===rr){tt.complete()}return true}for(var oo=0;oo<rr;oo++){var ss=this.images[oo];ss.on("confirm",qq);ss.check()}};uu.prototype.progress=function(oo){this.hasAnyBroken=this.hasAnyBroken||!oo.isLoaded;var pp=this;setTimeout(function(){pp.emit("progress",pp,oo);if(pp.jqDeferred&&pp.jqDeferred.notify){pp.jqDeferred.notify(pp,oo)}})};uu.prototype.complete=function(){var oo=this.hasAnyBroken?"fail":"done";this.isComplete=true;var pp=this;setTimeout(function(){pp.emit(oo,pp);pp.emit("always",pp);if(pp.jqDeferred){var qq=pp.hasAnyBroken?"reject":"resolve";pp.jqDeferred[qq](pp)}})};if(tt){tt.fn.imagesLoaded=function(pp,qq){var oo=new uu(this,pp,qq);return oo.jqDeferred.promise(tt(this))}}function pp(oo){this.img=oo}pp.prototype=new nn();pp.prototype.check=function(){var oo=yy[this.img.src]||new zz(this.img.src);if(oo.isConfirmed){this.confirm(oo.isLoaded,"cached was confirmed");return}if(this.img.complete&&this.img.naturalWidth!==undefined){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}var pp=this;oo.on("confirm",function(qq,rr){pp.confirm(qq.isLoaded,rr);return true});oo.check()};pp.prototype.confirm=function(oo,pp){this.isLoaded=oo;this.emit("confirm",this,pp)};var yy={};function zz(oo){this.src=oo;yy[oo]=this}zz.prototype=new nn();zz.prototype.check=function(){if(this.isChecked){return}var oo=new Image();oo.bind(oo,"load",this);oo.bind(oo,"error",this);oo.src=this.src;this.isChecked=true};zz.prototype.handleEvent=function(oo){var pp="on"+oo.type;if(this[pp]){this[pp](oo)}};zz.prototype.onload=function(oo){this.confirm(true,"onload");this.unbindProxyEvents(oo)};zz.prototype.onerror=function(oo){this.confirm(false,"onerror");this.unbindProxyEvents(oo)};zz.prototype.confirm=function(oo,pp){this.isConfirmed=true;this.isLoaded=oo;this.emit("confirm",this,pp)};zz.prototype.unbindProxyEvents=function(oo){oo.unbind(oo.target,"load",this);oo.unbind(oo.target,"error",this)};return uu});